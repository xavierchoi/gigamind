<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="page_title">GigaMind — Knowledge Graph</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;500;600&family=IBM+Plex+Sans:wght@400;500;600&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Skip to main content link for keyboard users -->
  <a href="#graph-canvas" class="skip-link" data-i18n="skip_to_graph">Skip to graph</a>

  <!-- Subtle texture overlay -->
  <div class="texture-overlay" aria-hidden="true"></div>

  <!-- Ambient background -->
  <div class="ambient-bg" aria-hidden="true">
    <div class="ambient-orb ambient-orb--1"></div>
    <div class="ambient-orb ambient-orb--2"></div>
  </div>

  <!-- Screen reader announcements -->
  <div id="sr-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <!-- Graph statistics summary for screen readers -->
  <div id="sr-graph-summary" class="sr-only" aria-live="polite"></div>

  <!-- Main graph canvas -->
  <svg id="graph-canvas" role="img" aria-label="Knowledge graph visualization showing connections between notes"></svg>

  <!-- Header bar -->
  <header class="header">
    <div class="header__brand">
      <div class="header__logo">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="3" fill="currentColor"/>
          <circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="1.5" opacity="0.5"/>
          <circle cx="12" cy="12" r="11" stroke="currentColor" stroke-width="1" opacity="0.25"/>
        </svg>
      </div>
      <span class="header__title">GigaMind</span>
      <span class="header__version">v0.1.5</span>
    </div>
    <div class="header__stats">
      <div class="header__stat">
        <span class="header__stat-value" id="stat-notes">—</span>
        <span class="header__stat-label" data-i18n="stat_nodes">nodes</span>
      </div>
      <div class="header__stat-divider"></div>
      <div class="header__stat">
        <span class="header__stat-value" id="stat-connections">—</span>
        <span class="header__stat-label" data-i18n="stat_edges">edges</span>
      </div>
      <div class="header__stat-divider"></div>
      <div class="header__stat header__stat--warning">
        <span class="header__stat-value" id="stat-dangling">—</span>
        <span class="header__stat-label" data-i18n="stat_dangling">dangling</span>
      </div>
      <div class="header__stat-divider"></div>
      <div class="header__stat header__stat--muted">
        <span class="header__stat-value" id="stat-orphan">—</span>
        <span class="header__stat-label" data-i18n="stat_orphan">orphan</span>
      </div>
    </div>
  </header>

  <!-- Command bar (search + filters) -->
  <div class="command-bar">
    <div class="search-wrapper">
      <div class="search-icon">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35"/>
        </svg>
      </div>
      <input
        type="text"
        id="search-input"
        class="search-input"
        data-i18n-placeholder="search_placeholder"
        placeholder="Search nodes..."
        autocomplete="off"
        spellcheck="false"
      >
      <kbd class="search-shortcut">/</kbd>
      <!-- Search results dropdown -->
      <div class="search-results" id="search-results" hidden>
        <div class="search-results__header">
          <span class="search-results__count" id="search-count">0 results</span>
          <button class="search-results__clear" id="search-clear" data-i18n="search_clear">Clear</button>
        </div>
        <ul class="search-results__list" id="search-results-list"></ul>
      </div>
    </div>

    <!-- Filter toggles -->
    <div class="filter-group">
      <button class="filter-btn filter-btn--active" data-filter="note" data-i18n-title="filter_notes_title" title="Notes">
        <span class="filter-indicator filter-indicator--note"></span>
        <span class="filter-label" data-i18n="filter_notes">Notes</span>
      </button>
      <button class="filter-btn filter-btn--active" data-filter="orphan" data-i18n-title="filter_orphan_title" title="Orphan nodes">
        <span class="filter-indicator filter-indicator--orphan"></span>
        <span class="filter-label" data-i18n="filter_orphan">Orphan</span>
      </button>
      <button class="filter-btn filter-btn--active" data-filter="dangling" data-i18n-title="filter_dangling_title" title="Dangling references">
        <span class="filter-indicator filter-indicator--dangling"></span>
        <span class="filter-label" data-i18n="filter_dangling">Dangling</span>
      </button>
    </div>

    <!-- Similar Links toggle -->
    <button class="filter-btn" id="similar-links-toggle" data-i18n-title="similar_links_toggle_title" title="Similar Links">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="6" cy="6" r="3"/>
        <circle cx="18" cy="6" r="3"/>
        <circle cx="12" cy="18" r="3"/>
        <line x1="9" y1="6" x2="15" y2="6"/>
        <line x1="7.5" y1="8.5" x2="10.5" y2="15.5"/>
        <line x1="16.5" y1="8.5" x2="13.5" y2="15.5"/>
      </svg>
      <span class="filter-label" data-i18n="similar_links_label">Similar</span>
    </button>

    <!-- View controls -->
    <div class="control-group">
      <button class="control-btn" id="zoom-out" data-i18n-title="zoom_out_title" title="Zoom out (-)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
      </button>
      <span class="zoom-level" id="zoom-level">100%</span>
      <button class="control-btn" id="zoom-in" data-i18n-title="zoom_in_title" title="Zoom in (+)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
      </button>
      <div class="control-divider"></div>
      <button class="control-btn" id="reset-view" data-i18n-title="reset_view_title" title="Reset view (0)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
          <path d="M3 3v5h5"/>
        </svg>
      </button>
      <button class="control-btn" id="toggle-labels" data-i18n-title="toggle_labels_title" title="Toggle labels">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 7V4h16v3"/>
          <path d="M9 20h6"/>
          <path d="M12 4v16"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Breadcrumb Navigation -->
  <nav class="breadcrumb" id="breadcrumb" hidden aria-label="Focus navigation">
    <!-- Populated dynamically by controls.js -->
  </nav>

  <!-- Minimap -->
  <div class="minimap" id="minimap">
    <div class="minimap__header">
      <span class="minimap__title" data-i18n="minimap_title">Overview</span>
      <button class="minimap__toggle" id="minimap-toggle" data-i18n-title="minimap_collapse_title" title="Collapse">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </button>
    </div>
    <canvas id="minimap-canvas" width="180" height="120"></canvas>
    <div class="minimap__viewport" id="minimap-viewport"></div>
  </div>

  <!-- Similar Links Panel -->
  <aside class="similar-links-panel" id="similar-links-panel" hidden>
    <header class="similar-links-panel__header">
      <h2 class="similar-links-panel__title" data-i18n="similar_links_title">Similar Links</h2>
      <button class="similar-links-panel__close" id="close-similar-links" data-i18n-aria-label="sidebar_close" aria-label="Close">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </header>

    <!-- Analysis controls -->
    <div class="similar-links-panel__controls">
      <div class="similar-links-panel__threshold">
        <label class="similar-links-panel__label" data-i18n="similar_links_threshold">Threshold</label>
        <input type="range" id="similarity-threshold" min="50" max="95" value="70" class="similar-links-panel__slider">
        <span class="similar-links-panel__threshold-value" id="threshold-value">70%</span>
      </div>
      <button class="similar-links-panel__analyze-btn" id="analyze-similar-links">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"/>
          <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
        </svg>
        <span data-i18n="similar_links_analyze">Analyze</span>
      </button>
    </div>

    <!-- Loading state -->
    <div class="similar-links-panel__loading" id="similar-links-loading" hidden role="status" aria-live="polite">
      <div class="similar-links-panel__spinner"></div>
      <span data-i18n="similar_links_loading">Analyzing similar links...</span>
    </div>

    <!-- Empty state -->
    <div class="similar-links-panel__empty" id="similar-links-empty" hidden role="status" aria-live="polite">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10"/>
        <path d="M8 15s1.5 2 4 2 4-2 4-2"/>
        <line x1="9" y1="9" x2="9.01" y2="9"/>
        <line x1="15" y1="9" x2="15.01" y2="9"/>
      </svg>
      <p data-i18n="similar_links_no_results">No similar dangling links found</p>
    </div>

    <!-- Clusters list -->
    <div class="similar-links-panel__clusters" id="similar-links-clusters"></div>
  </aside>

  <!-- Merge Confirmation Modal -->
  <div class="merge-modal" id="merge-modal" hidden>
    <div class="merge-modal__backdrop"></div>
    <div class="merge-modal__content">
      <h3 class="merge-modal__title" data-i18n="merge_confirm_title">Confirm Merge</h3>
      <p class="merge-modal__message" id="merge-modal-message"></p>

      <div class="merge-modal__options">
        <label class="merge-modal__checkbox">
          <input type="checkbox" id="merge-preserve-alias" checked>
          <span data-i18n="merge_preserve_alias">Preserve original text as alias</span>
        </label>
      </div>

      <div class="merge-modal__actions">
        <button class="merge-modal__btn merge-modal__btn--secondary" id="merge-cancel">
          <span data-i18n="merge_cancel">Cancel</span>
        </button>
        <button class="merge-modal__btn merge-modal__btn--primary" id="merge-confirm">
          <span data-i18n="merge_confirm">Merge</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Node detail sidebar -->
  <aside class="sidebar" id="node-sidebar" hidden>
    <button class="sidebar__close" id="close-sidebar" data-i18n-aria-label="sidebar_close" aria-label="Close">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>

    <header class="sidebar__header">
      <span class="sidebar__badge" id="sidebar-type">NOTE</span>
      <h2 class="sidebar__title" id="sidebar-title">—</h2>
      <p class="sidebar__path" id="sidebar-path">—</p>
    </header>

    <!-- Note preview -->
    <div class="sidebar__preview" id="sidebar-preview">
      <p class="sidebar__preview-text" id="sidebar-preview-text"></p>
    </div>

    <!-- Connection stats -->
    <div class="sidebar__stats">
      <div class="sidebar__stat">
        <span class="sidebar__stat-icon">←</span>
        <span class="sidebar__stat-value" id="backlinks-count">0</span>
        <span class="sidebar__stat-label" data-i18n="sidebar_inbound">inbound</span>
      </div>
      <div class="sidebar__stat">
        <span class="sidebar__stat-icon">→</span>
        <span class="sidebar__stat-value" id="forwardlinks-count">0</span>
        <span class="sidebar__stat-label" data-i18n="sidebar_outbound">outbound</span>
      </div>
    </div>

    <div class="sidebar__section">
      <h3 class="sidebar__section-title">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
        <span data-i18n="sidebar_backlinks">Backlinks</span>
      </h3>
      <ul class="sidebar__list" id="backlinks-list"></ul>
    </div>

    <div class="sidebar__section">
      <h3 class="sidebar__section-title">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
        <span data-i18n="sidebar_forward_links">Forward Links</span>
      </h3>
      <ul class="sidebar__list" id="forwardlinks-list"></ul>
    </div>

    <!-- Dangling node action - Create Note button -->
    <div class="sidebar__action" id="sidebar-create-note" hidden>
      <button class="sidebar__create-btn" id="create-note-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        <span data-i18n="create_note_btn">Create note from this concept</span>
      </button>
      <p class="sidebar__create-hint" data-i18n="create_note_hint">Click to copy GigaMind command to clipboard</p>
    </div>
  </aside>

  <!-- Focus mode indicator -->
  <div class="focus-bar" id="focus-indicator" hidden>
    <div class="focus-bar__content">
      <span class="focus-bar__icon">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      </span>
      <span class="focus-bar__label" data-i18n="focus_mode_label">Focus Mode</span>
      <span class="focus-bar__node" id="focus-node-name">—</span>
    </div>
    <button class="focus-bar__exit" id="exit-focus">
      <span data-i18n="focus_exit">Exit</span> <kbd>ESC</kbd>
    </button>
  </div>

  <!-- Load More bar for progressive loading -->
  <div class="load-more-bar" id="load-more-bar" hidden>
    <span class="load-more-bar__progress" id="load-progress-text" data-i18n-template="load_progress">Showing 0 of 0 nodes</span>
    <div class="load-more-bar__actions">
      <button class="load-more-bar__btn load-more-bar__btn--secondary" id="load-more-btn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
        <span data-i18n="load_more">Load More</span>
      </button>
      <button class="load-more-bar__btn load-more-bar__btn--primary" id="load-all-btn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="16"/>
          <line x1="8" y1="12" x2="16" y2="12"/>
        </svg>
        <span data-i18n="load_full_graph">Load Full Graph</span>
      </button>
    </div>
  </div>

  <!-- Enhanced tooltip -->
  <div class="tooltip" id="tooltip" role="tooltip" hidden>
    <div class="tooltip__title" id="tooltip-title"></div>
    <div class="tooltip__meta" id="tooltip-meta"></div>
  </div>

  <!-- Loading state -->
  <div class="loading" id="loading">
    <div class="loading__content">
      <div class="loading__rings">
        <div class="loading__ring loading__ring--1"></div>
        <div class="loading__ring loading__ring--2"></div>
        <div class="loading__ring loading__ring--3"></div>
      </div>
      <span class="loading__text" data-i18n="loading_text">Initializing neural graph...</span>
    </div>
  </div>

  <!-- Keyboard shortcuts help -->
  <div class="shortcuts-hint" role="note" aria-label="Keyboard shortcuts">
    <kbd>/</kbd> <span data-i18n="shortcuts_search">search</span>
    <kbd>+</kbd><kbd>-</kbd> <span data-i18n="shortcuts_zoom">zoom</span>
    <kbd>0</kbd> <span data-i18n="shortcuts_reset">reset</span>
    <kbd>S</kbd> <span data-i18n="shortcuts_similar">similar</span>
    <kbd>ESC</kbd> <span data-i18n="shortcuts_exit">exit</span>
    <kbd>F</kbd> <span data-i18n="shortcuts_fullscreen">fullscreen</span>
    <kbd>Tab</kbd> <span data-i18n="shortcuts_navigate">navigate nodes</span>
  </div>

  <!-- Toast notification -->
  <div class="toast" id="toast" hidden role="status" aria-live="polite">
    <span class="toast__message" id="toast-message"></span>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="js/graph.js"></script>
  <script src="js/controls.js"></script>
  <script src="js/similar-links.js"></script>
</body>
</html>
